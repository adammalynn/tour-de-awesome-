<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <style>
html, body {
  margin: 0;
  }

.full-height {
  height: 600px;
  width: 50%;
  background: yellow;
}
</style>
</head>

<body>
<div id="myDiv" class="full-height">
<script>
/*=========Build a box plot ==============*/
var url = `/speeds`;

// console.log(url)
d3.json(url).then(function(response)  {

  var data = [];
  var traces = [];

  response.forEach(data => {
    if (data.type=="Flat stage") {
      var color = "rgb(43, 255, 230)"
    }
    else if (data.type=="Mountain stage") {
      var color = "rgb(249, 2, 229)"
    }
    else if (data.type=="Team time trial" || data.type=="Individual time trial") {
      var color = "rgb(246, 255, 5)"
    }
    else {
      var color = "rgb(88, 249, 1)"
    }

    var trace = {
      y: data.data.speed,
      orientation:"v",
      width:0.5,
      hovertext: data.data.rider,
      hoverlabel:{bgcolor:color},
      type: 'box',
      name: data.stage,
      boxpoints: 'all',
      jitter: 1,
      pointpos: 0,
      whiskerwidth: 0.2,
      fillcolor: color,
      box: {visible:false},
      marker: {
          size: 3,
          color: color,
          outliercolor: "rgb(255, 2, 10)",
      line: {
          width: 1,
          color: "black",
          outliercolor: "rgb(255, 2, 10)",
          outlierwidth:2.5
      }
    }
    }
    traces.push(trace)
  });

var layout = {
    title: '2018 Tour de France Speeds by Stage',
    xaxis: {
    showgrid: true,
    dtick:1,
    zeroline: false,
    tickangle: 90,
    showticklabels: true
  },
    yaxis: {
        autorange: true,
        showgrid: true,
        dtick: 5,
        gridcolor: 'rgb(66,66,66)',
        gridwidth: 1,
        zeroline: false
    },
    margin: {
        l: 80,
        r: 30,
        b: 80,
        t: 100
    },
    paper_bgcolor: 'white',
    plot_bgcolor: 'white',
    showlegend: false};
Plotly.newPlot('myDiv', traces, layout);
//===================
});
</script>
</div>
</body>
